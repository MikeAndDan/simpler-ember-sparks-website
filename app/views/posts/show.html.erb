<% content_for :head do %>
  <meta property="og:image" content="<%= @post.thumbnail_image %>">

  <script src="//fast.wistia.com/static/embed_shepherd-v1.js"></script>
  <script>
    wistiaEmbeds.onFind(function(video) {
      video.videoFoam(true);
    });
  </script>
<% end %>
<% content_for :title, @post.title %>
<% content_for :meta_description, @post.description %>

<p id="notice"><%= notice %></p>

<h1>
  <%= @post.title %>
</h1>

<div class="row">
  <div class="col-lg-9 col-md-12">
    <% if current_user.try(:subscribed) or @post.free %>
      <%= render 'video', video_url: @post.video_url, wistia_embed: @post.wistia_embed %>
    <% else %>
      <div class="sales-box">
        <h2>You can view Pro screencasts by subscribing</h2>
        <span class="btn login-path-button"><a href="/users/sign_in">Already a Subscriber? Log in</a></span>
        <form action="/subscribe" method="POST">
          <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>
          <script
            src="https://checkout.stripe.com/checkout.js" class="stripe-button"
            data-key="<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>"
            data-name="EmberScreencasts.com"
            data-description="Monthly Subscription"
            data-label="Subscribe for $9.95/month"
            data-panel-label="Subscribe {{amount}}/month"
            data-amount="995">
          </script>
        </form>
        <span class="btn free-screencasts-button"><a href="/posts?free=true">Show me only Free screencasts</a></span>
      </div>
      <hr>
      <a href="/account">
        <%= image_tag @post.thumbnail_image, class: "img-responsive" %>
      </a>
    <% end %>

    <div class="published-on">
      <small>
        <% if @post.free %> Free <% else %> Pro <% end %>
        --
        <%= @post.publish_date %>
        --
        <a href="/posts?difficulty=<%=@post.difficulty%>"><%= @post.difficulty %></a>
      </small>
    </div>
  </div>

  <div class="col-lg-3 col-md-12">
    <div class="description">
      <h4>About this video</h4>
      <%= raw @markdown.render @post.description %>
    </div>

    <h4> More videos like this</h4>
    <% @post.tags.each do |tag| %>
      <div class="tag-link"><span class="tag-type"><%= tag.tag_type %></span>:  <%= link_to tag.name, tag_path(tag) %></div>
    <% end %>

    <% if @post.links && @post.links.length > 0 %>
    <div class="links">
      <h4>Links</h4>
      <%= raw @markdown.render(@post.links) %>
    </div>
    <% end %>
  </div>
</div>
